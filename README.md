# 2024-winter-cmap

## Project Background

The Chicago Metropolitan Agency for Planning (CMAP) is interested in being able to use machine learning to identify locations of stormwater storage and other related geographic features throughout Chicago and the surrounding area.  
To begin the project, CMAP has provided labeled geographic features in Kane County, Illinois, to be used to create a predictive model.
The code in this repo is used to:
1. Create masks of geographic features across the area.
2. Train and test various predictive models on surrounding geographies.

## Project Goals

There are several tasks associated with this project:

1. Create and train a model to predict instances of various geographic features through satellite imagery.
2. 

## Usage
Before running the repo (see details below) you will need to do the following:
1. Install make if you have not already done so.
2. Create and initiate a cmap specific conda environment using the following steps:
    1. Install miniconda:
    '''
    mkdir -p ~/miniconda3
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh
    bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
    '''
    2. Create environment:
    '''
    conda create -y --name cmap python=3.10
    conda activate cmap
    conda install pytorch torchvision pytorch-cuda=12.1 -c pytorch -c nvidia
    '''

### Make

We use `make` to run our code. There are three built-in `make` commands:

* `make build-only`: This will build the image only. It is useful for testing and making changes to the Dockerfile.
* `make run-notebooks`: This will run a jupyter server which also mounts the current directory into `\program`.
* `make run-interactive`: This will create a container (with the current directory mounted as `\program`) and loads an interactive session. 

The file `Makefile` contains information about about the specific commands that are run using when calling each `make` statement.

### Developing inside a container with VS Code

If you prefer to develop inside a container with VS Code then do the following steps. Note that this works with both regular scripts as well as jupyter notebooks.

1. Open the repository in VS Code
2. At the bottom right a window may appear that says `Folder contains a Dev Container configuration file...`. If it does, select, `Reopen in Container` and you are done. Otherwise proceed to next step. 
3. Click the blue or green rectangle in the bottom left of VS code (should say something like `><` or `>< WSL`). Options should appear in the top center of your screen. Select `Reopen in Container`.


 ### Slurm
If you are using the DSI's cluster then you have another option with your `make` commands which is to run VS Code on the cluster login node. To do this execute in `make run-ssh`. 

For more information about how to use Slurm, please look at the information [here](https://github.com/uchicago-dsi/core-facility-docs/blob/main/slurm.md).


## Repository Structure

### utils
Project python code. Contains various utility functions and scripts which support the main functionalities of the project and are designed to be reusable. 

### notebooks
Contains short, clean notebooks to demonstrate analysis. Notebooks should be documented and a short description added to the [README.md](notebooks/README.md) file.

### data

Contains details of acquiring all raw data used in repository. If data is small (<50MB) then it is okay to save it to the repo, making sure to clearly document how to the data is obtained.

If the data is larger than 50MB than you should not add it to the repo and instead document how to get the data in the README.md file in the data directory. 

This [README.md file](/data/README.md) should be kept up to date.

### output
Should contain work product generated by the analysis. Keep in mind that results should (generally) be excluded from the git repository.

### collaborators
Matthew Rubenstein - rubensteinm@uchicago.edu
Tamami Tamura - tamamitamura@uchicago.edu
Spencer Ellis - sjne@uchicago.edu
